<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Programmer Pok√©mon Club</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800;900&display=swap" rel="stylesheet">
</head>

<body>

<!-- DEKORACE ‚Äì MEWTWO (NIC NEPOSOUV√Å) -->
<div class="bgPokemon bgLeft">
    <img th:src="@{/Mewto.png}" alt="Mewtwo">
</div>
<div class="bgPokemon1 bgRight">
    <img th:src="@{/Mew.png}" alt="Mew">
</div>

<main>

    <!-- NAVBAR -->
    <nav class="navbar" th:if="${users != null}">
        <div class="nav-left">
            <span class="nav-badge">
                <span class="nav-dot"></span>
                <span class="nav-user" th:text="${users.username}"></span>
            </span>
        </div>

        <div class="nav-right">
            <a class="btn btn-ghost btn-danger" th:href="@{/pokemonclub}">Sign out</a>
        </div>
    </nav>

    <!-- LOGO -->
    <img class="logo" th:src="@{/logo.svg.png}" alt="Logo">

    <!-- ERROR -->
    <div class="notice" th:if="${users == null}">
        <h2>User not loaded</h2>
        <p class="muted">Session expired or user not found.</p>
        <a class="btn btn-primary" th:href="@{/loginUser}">Go to login</a>
    </div>

    <!-- USER INFO -->
    <section class="card dashboard" th:if="${users != null}">
        <header class="cardHead userHeader">
            <div class="userInfo">
                <div class="kicker">USER</div>
                <h1 class="title" th:text="${users.username}"></h1>
            </div>

            <div class="userAvatar">
                <img th:src="${users.profileImagePath}" alt="Avatar">
            </div>
        </header>

        <div class="divider"></div>

        <div class="dashboardGrid">

            <!-- POKEMONS LIST -->
            <section class="cardInner">
                <div class="sectionHead">
                    <h2>Your Pok√©mons</h2>
                    <span class="pill" th:text="${pokemons != null} ? ${#lists.size(pokemons)} : 0"></span>
                </div>

                <div class="tableWrap">
                    <table>
                        <thead>
                        <tr>
                            <th>Pok√©mon</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${pokemons == null or pokemons.size() == 0}">
                            <td class="muted">No Pok√©mon yet</td>
                        </tr>

                        <tr th:each="p : ${pokemons}">
                            <td>
                                <div class="pokeRow">

                                    <!-- NAME + HOVER CARD -->
                                    <span class="pokeHover">
                                        <span class="pokeName" th:text="${p.name}"></span>

                                        <span class="pokeCard">
                                            <img th:src="${p.imagePath}" th:alt="${p.name}">
                                            <span class="pokeCardTitle" th:text="${p.name}"></span>
                                        </span>
                                    </span>

                                    <!-- RIGHT ACTIONS (Play + Delete) -->
                                    <div class="pokeActions">

                                        <!-- ‚ñ∂ PLAY -->
                                        <button type="button"
                                                class="pokePlay"
                                                th:attr="data-sound=${#strings.toLowerCase(p.name)}"
                                                title="Play sound">‚ñ∂</button>

                                        <!-- üóë DELETE -->
                                        <form method="POST" th:action="@{/deletePokemon}" class="pokeDeleteForm">
                                            <input type="hidden" name="name" th:value="${users.username}">
                                            <input type="hidden" name="pokemonId" th:value="${p.id}">
                                            <button type="submit" class="pokeDelete" title="Delete Pok√©mon">‚úï</button>
                                        </form>
                                    </div>

                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- CATCH NEW POKEMON -->
            <section class="cardInner">
                <div class="sectionHead">
                    <h2>Catch new Pok√©mon</h2>
                </div>

                <form method="POST"
                      th:action="@{/addAnotherPokemon}"
                      class="authForm"
                      id="catchPokemonForm">

                    <input type="hidden" name="name" th:value="${users.username}"/>

                    <div class="field">
                        <label for="pokemonName">Choose Pok√©mon</label>
                        <select id="pokemonName" name="pokemonName" class="input" required>
                            <option value="" disabled selected>‚Äî choose ‚Äî</option>
                            <option value="Pikachu">Pikachu</option>
                            <option value="Bulbasaur">Bulbasaur</option>
                            <option value="Charmander">Charmander</option>
                            <option value="Squirtle">Squirtle</option>
                            <option value="Eevee">Eevee</option>
                        </select>
                    </div>

                    <button class="btn btn-primary btn-block" type="submit">
                        Catch Pok√©mon
                    </button>
                </form>

            </section>

        </div>
    </section>

</main>

<!-- üîä Pok√©mon sounds -->
<audio id="pikachuSound" src="/pikachuSound.mp3" preload="auto"></audio>
<audio id="bulbasaurSound" src="/bulbasaurSound.mp3" preload="auto"></audio>
<audio id="charmanderSound" src="/charmanderSound.mp3" preload="auto"></audio>
<audio id="squirtleSound" src="/squirtleSound.mp3" preload="auto"></audio>
<audio id="eeveeSound" src="/eeveeSound.mp3" preload="auto"></audio>

<script>
    (() => {
      // ‚ñ∂ Play button u ka≈æd√©ho pok√©mona
      document.addEventListener('click', (e) => {
        const btn = e.target.closest('.pokePlay');
        if (!btn) return;

        const base = btn.getAttribute('data-sound');
        if (!base) return;

        const audio = document.getElementById(base + 'Sound');
        if (!audio) return;

        audio.pause();
        audio.currentTime = 0;
        audio.volume = 0.9;
        audio.play().catch(() => {});
      });
    })();
</script>

</body>
</html>